<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convex Hull Recursivo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        canvas {
            border: 1px solid black;
            margin-top: 20px;
        }

        #result {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>Convex Hull Recursivo</h1>
    <div>
        <label for="numPoints">Número de puntos:</label>
        <input type="number" id="numPoints" min="3" value="20">
        <button id="generateBtn">Generar Puntos</button>
        <button id="solveBtn">Resolver</button>
    </div>
    <canvas id="canvas" width="600" height="600"></canvas>
    <div id="result"></div>

    <textarea name="cities" id="citiesinput" cols="50" rows="20"></textarea>


    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const numPointsInput = document.getElementById('numPoints');
        const generateBtn = document.getElementById('generateBtn');
        const solveBtn = document.getElementById('solveBtn');
        const resultDiv = document.getElementById('result');

        const citiesInput = document.querySelector('#citiesinput');

        let points = [];
        const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'];

        function generatePoints() {
            const numPoints = parseInt(numPointsInput.value);
            points = [];
            for (let i = 0; i < numPoints; i++) {
                points.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height
                });
            }
            citiesInput.value = JSON.stringify(points, null, 2);
            drawPoints();
            resultDiv.textContent = '';
        }

        function drawPoints() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'black';
            for (let point of points) {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 3, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        function orientation(p, q, r) {
            const val = (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);
            if (val === 0) return 0;
            return (val > 0) ? 1 : 2;
        }

        function convexHull(points) {
            const n = points.length;
            if (n < 3) return points;

            let hull = [];
            let leftmost = 0;
            for (let i = 1; i < n; i++) {
                if (points[i].x < points[leftmost].x) {
                    leftmost = i;
                }
            }

            let p = leftmost, q;
            do {
                hull.push(points[p]);
                q = (p + 1) % n;
                for (let i = 0; i < n; i++) {
                    if (orientation(points[p], points[i], points[q]) === 2) {
                        q = i;
                    }
                }
                p = q;
            } while (p !== leftmost);

            return hull;
        }

        function drawConvexHull(hull, color) {
            ctx.strokeStyle = color;
            ctx.beginPath();
            ctx.moveTo(hull[0].x, hull[0].y);
            for (let i = 1; i < hull.length; i++) {
                ctx.lineTo(hull[i].x, hull[i].y);
            }
            ctx.closePath();
            ctx.stroke();
        }

        function solve() {
            let remainingPoints = [...points];
            let colorIndex = 0;
            let hullCount = 0;

            while (remainingPoints.length > 0) {
                const hull = convexHull(remainingPoints);
                drawConvexHull(hull, colors[colorIndex % colors.length]);

                remainingPoints = remainingPoints.filter(point =>
                    !hull.some(hullPoint =>
                        hullPoint.x === point.x && hullPoint.y === point.y
                    )
                );

                colorIndex++;
                hullCount++;
            }

            resultDiv.textContent = `Número de Convex Hulls generados: ${hullCount}`;
        }

        generateBtn.addEventListener('click', generatePoints);
        solveBtn.addEventListener('click', solve);

        citiesInput.addEventListener('input', () => {
            try {
                // Intentar parsear el contenido del textarea como JSON
                let jsonText = citiesInput.value.replace(/^\s+|\s+$/g, ''); //Elimina espacios al inicio o al final
                let parsedJSON = JSON.parse(jsonText);

                // Si llegamos aquí, el JSON es válido
                // Actualizar el array con el nuevo contenido
                points = parsedJSON;
                // generateRandomPoints();
                drawPoints();
                solve();

            } catch (error) {
                // Si llegamos aquí, el JSON no es válido
                console.error('JSON inválido:', error);
            }
        });

        generatePoints();
    </script>
</body>

</html>